<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:py="http://genshi.edgewall.org/">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>Mail Throttler</title>
    <link href="default.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="jquery-1.3.2.min.js"></script>
  </head>
  <body>
    <div id="header">
      <h1>Mail Throttler</h1>
      <h2>Admin Console</h2>
    </div>
    <div id="menu">
      <ul>
	<li><a href="/">Home</a></li>
	<li><a href="#">Contact Us</a></li>
      </ul>
    </div>
    <div id="content">
      <div>
	<h2>Current Stats</h2>
	<ul>
	  <?python
	    extraCounts = [key for key in counts.keys() if key not in ['total', 'current']]
	  ?>

	  <li>Currently counting ${counts["current"]} messages</li>
	  <li>Seen a total of ${counts["total"]} messages</li>
	  <li py:if="len(extraCounts) > 0">Additional Counts<br/>
	    <ul>

	      <li py:for="key in extraCounts">${key}:${counts[key]}</li>
	    </ul>
	  </li>
	</ul>
	
	<h2>Actions</h2>
	<ul>
	  <li>
	    <form action="/" method="post">
	      <div>Change Logging level to: 
	      <select name="logLevel">
		<option>DEBUG</option>
		<option>INFO</option>
	      </select>
	      <input type="submit" value="Change" />
	      </div>
	    </form>
	  </li>
	  <li><a href="/config">View Current Config</a></li>
	</ul>
	<h2>Current Log - ${currentLevel}</h2>
	<a id="refreshLog" href="#">Refresh</a>
	<textarea id="logbox" readonly="readonly" ></textarea>
	</div>
    </div>
    <div id="footer">
      <p>Copyright &copy; 2009 Andrew Cox. Designed by <a href="http://www.freecsstemplates.org" class="link1">Free CSS Templates</a></p>
    </div>
    <script type="text/javascript">
      //<![CDATA[

      function refreshLog()
      {
      //Make AJAX call here
      $.ajax(
        { type:"GET",
          url:"ajax?log",
          dataType:"json",
          success: function (data) 
                   {
                   $("#logbox").val("")
                   for (i = data.log.length-1; i > 0 ;i--)
                     {
                     logitem = data.log[i];
                     var line = logitem.asctime + " - " + logitem.name + " - " + logitem.levelname + " - " + logitem.message + "\n";
                     $("#logbox").val(line + $("#logbox").val() );
                     }
                   }
        }
      )
      }

      $(document).ready( function () {
      refreshLog()
      $("#refreshLog").click(refreshLog);
      setInterval(refreshLog, 10000);
      }
      );
      //]]>
    </script>
  </body>
</html>
